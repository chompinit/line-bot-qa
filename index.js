require("dotenv").config();
const express = require("express");
const line = require("@line/bot-sdk");

const app = express();

const config = {
  channelSecret: process.env.CHANNEL_SECRET,
  channelAccessToken: process.env.CHANNEL_ACCESS_TOKEN,
};

const client = new line.Client(config);
const QA = [
  {
    id: "q1",
    question: "à¸„à¸¸à¸“à¸ªà¸¡à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸‚à¸­à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸à¸²à¸£à¸ªà¸­à¸™ à¹€à¸žà¸·à¹ˆà¸­à¸‚à¸­à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸—à¸²à¸‡à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸œà¸¹à¹‰à¸Šà¹ˆà¸§à¸¢à¸¨à¸²à¸ªà¸•à¸£à¸²à¸ˆà¸²à¸£à¸¢à¹Œ à¸£à¸­à¸‡à¸¨à¸²à¸ªà¸•à¸£à¸²à¸ˆà¸²à¸£à¸¢à¹Œ à¹à¸¥à¸°à¸¨à¸²à¸ªà¸•à¸£à¸²à¸ˆà¸²à¸£à¸¢à¹Œ",
    answer: "à¹ƒà¸«à¹‰à¸žà¸´à¸ˆà¸²à¸£à¸“à¸²à¸ˆà¸²à¸à¸„à¸¸à¸“à¸ªà¸¡à¸šà¸±à¸•à¸´à¹€à¸‰à¸žà¸²à¸°à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ à¸œà¸¥à¸à¸²à¸£à¸ªà¸­à¸™ à¸œà¸¥à¸‡à¸²à¸™à¸—à¸²à¸‡à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¹à¸¥à¸°à¸ˆà¸£à¸´à¸¢à¸˜à¸£à¸£à¸¡à¹à¸¥à¸°à¸ˆà¸£à¸£à¸¢à¸²à¸šà¸£à¸£à¸“à¸—à¸²à¸‡à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸à¸£à¸°à¸—à¸³à¹„à¸”à¹‰ 2 à¸§à¸´à¸˜à¸µ à¸„à¸·à¸­ à¸à¸²à¸£à¹à¸•à¹ˆà¸‡à¸•à¸±à¹‰à¸‡à¹‚à¸”à¸¢à¸§à¸´à¸˜à¸µà¸›à¸à¸•à¸´ à¹à¸¥à¸°à¸à¸²à¸£à¹à¸•à¹ˆà¸‡à¸•à¸±à¹‰à¸‡à¹‚à¸”à¸¢à¸§à¸´à¸˜à¸µà¸žà¸´à¹€à¸¨à¸©1.1 à¸„à¸¸à¸“à¸ªà¸¡à¸šà¸±à¸•à¸´à¹€à¸‰à¸žà¸²à¸°à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹ƒà¸™à¸à¸£à¸“à¸µà¸—à¸µà¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸²à¸£à¸°à¸”à¸±à¸šà¸›à¸£à¸´à¸à¸à¸²à¸•à¸£à¸µà¸«à¸£à¸·à¸­à¹€à¸—à¸µà¸¢à¸šà¹€à¸—à¹ˆà¸²à¸œà¸¹à¹‰à¸™à¸±à¹‰à¸™ à¸•à¹‰à¸­à¸‡à¸”à¸³à¸£à¸‡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸­à¸²à¸ˆà¸²à¸£à¸¢à¹Œ à¹à¸¥à¸°à¸—à¸³à¸à¸²à¸£à¸ªà¸­à¸™à¸¡à¸²à¹à¸¥à¹‰à¸§à¹„à¸¡à¹ˆà¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²à¸«à¸à¸›à¸µ à¸«à¸£à¸·à¸­à¹ƒà¸™à¸à¸£à¸“à¸µà¸—à¸µà¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸²à¸£à¸°à¸”à¸±à¸šà¸›à¸£à¸´à¸à¸à¸²à¹‚à¸—à¸«à¸£à¸·à¸­à¹€à¸—à¸µà¸¢à¸šà¹€à¸—à¹ˆà¸² à¸œà¸¹à¹‰à¸™à¸±à¹‰à¸™à¸•à¹‰à¸­à¸‡à¸”à¸³à¸£à¸‡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸­à¸²à¸ˆà¸²à¸£à¸¢à¹Œ à¹à¸¥à¸°à¸—à¸³à¸à¸²à¸£à¸ªà¸­à¸™à¸¡à¸²à¹à¸¥à¹‰à¸§à¹„à¸¡à¹ˆà¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²à¸ªà¸µà¹ˆà¸›à¸µ à¸«à¸£à¸·à¸­à¹ƒà¸™à¸à¸£à¸“à¸µà¸—à¸µà¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸²à¸£à¸°à¸”à¸±à¸šà¸›à¸£à¸´à¸à¸à¸²à¹€à¸­à¸à¸«à¸£à¸·à¸­à¹€à¸—à¸µà¸¢à¸šà¹€à¸—à¹ˆà¸² à¸œà¸¹à¹‰à¸™à¸±à¹‰à¸™à¸•à¹‰à¸­à¸‡à¸”à¸³à¸£à¸‡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸­à¸²à¸ˆà¸²à¸£à¸¢à¹Œ à¹à¸¥à¸°à¸—à¸³à¸à¸²à¸£à¸ªà¸­à¸™à¹à¸¥à¹‰à¸§à¹„à¸¡à¹ˆà¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²à¸«à¸™à¸¶à¹ˆà¸‡à¸›à¸µ à¹à¸¥à¸°à¸žà¹‰à¸™à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²à¸—à¸”à¸¥à¸­à¸‡à¸à¸²à¸£à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸”à¹‚à¸”à¸¢à¸ªà¸–à¸²à¸šà¸±à¸™à¸­à¸¸à¸”à¸¡à¸¨à¸¶à¸à¸©à¸²à¸™à¸±à¹‰à¸™à¹† 1.2 à¸­à¸²à¸ˆà¸²à¸£à¸¢à¹Œà¸žà¸´à¹€à¸¨à¸©à¸­à¸™à¸¸à¹‚à¸¥à¸¡à¹ƒà¸«à¹‰à¹ƒà¸Šà¹‰à¸„à¸¸à¸“à¸ªà¸¡à¸šà¸±à¸•à¸´à¹€à¸Šà¹ˆà¸™à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸šà¸­à¸²à¸ˆà¸²à¸£à¸¢à¹Œà¸›à¸£à¸°à¸ˆà¸³",
  },
  {
    id: "q2",
    question: "à¹€à¸à¸“à¸‘à¹Œà¸‚à¸­à¸‡à¸à¸²à¸£à¸‚à¸­à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸à¸²à¸£à¸ªà¸­à¸™",
    answer: "à¸ž1.2 à¸œà¸¥à¸à¸²à¸£à¸ªà¸­à¸™ à¸œà¸¹à¹‰à¸‚à¸­à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡à¸ªà¸­à¸™à¸›à¸£à¸°à¸ˆà¸³à¸§à¸´à¸Šà¸²à¹ƒà¸”à¸§à¸´à¸Šà¸²à¸«à¸™à¸¶à¹ˆà¸‡à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸”à¹„à¸§à¹‰à¹ƒà¸™à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£à¸‚à¸­à¸‡à¸ªà¸–à¸²à¸šà¸±à¸™à¸­à¸¸à¸”à¸¡à¸¨à¸¶à¸à¸©à¸² à¸‹à¸¶à¹ˆà¸‡à¹€à¸—à¸µà¸¢à¸šà¸„à¹ˆà¸²à¹„à¸”à¹‰à¹„à¸¡à¹ˆà¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²à¸ªà¸²à¸¡à¸«à¸™à¹ˆà¸§à¸¢à¸à¸´à¸•à¸£à¸°à¸šà¸šà¸—à¸§à¸´à¸ à¸²à¸„ à¹à¸¥à¸°à¸¡à¸µà¸„à¸§à¸²à¸¡à¸Šà¸³à¸™à¸²à¸à¹ƒà¸™à¸à¸²à¸£à¸ªà¸­à¸™à¸ˆà¸°à¸•à¹‰à¸­à¸‡à¹€à¸ªà¸™à¸­à¹€à¸­à¸à¸ªà¸²à¸£à¸«à¸¥à¸±à¸à¸à¸²à¸™à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¹ƒà¸™à¸à¸²à¸£à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸œà¸¥à¸à¸²à¸£à¸ªà¸­à¸™à¸—à¸µà¹ˆà¸œà¸¥à¸´à¸•à¸‚à¸¶à¹‰à¸™à¸•à¸²à¸¡à¸ à¸²à¸£à¸°à¸‡à¸²à¸™à¸ªà¸­à¸™ à¸‹à¸¶à¹ˆà¸‡à¸£à¸§à¸¡à¸à¸±à¸™à¹„à¸”à¹‰à¹„à¸¡à¹ˆà¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²à¸ªà¸²à¸¡à¸«à¸™à¹ˆà¸§à¸¢à¸à¸´à¸•à¸£à¸°à¸šà¸šà¸—à¸§à¸´à¸ à¸²à¸„ à¹à¸¥à¸°à¸¡à¸µà¸„à¸¸à¸“à¸ à¸²à¸žà¸•à¸²à¸¡à¸—à¸µà¹ˆà¸ªà¸ à¸²à¸ªà¸–à¸²à¸šà¸±à¸™à¸­à¸¸à¸”à¸¡à¸¨à¸¶à¸à¸©à¸²à¸à¸³à¸«à¸™à¸” à¸¡à¸µà¸à¸²à¸£à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡à¹à¸«à¸¥à¹ˆà¸‡à¸—à¸µà¹ˆà¸¡à¸²à¹à¸¥à¸°à¹„à¸”à¹‰à¹ƒà¸Šà¹‰à¸›à¸£à¸°à¸à¸­à¸šà¸à¸²à¸£à¸ªà¸­à¸™à¸¡à¸²à¹à¸¥à¹‰à¸§",
  },
  {
    id: "q3",
    question: "à¹€à¸­à¸à¸ªà¸²à¸£à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸‚à¸­à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸à¸²à¸£à¸ªà¸­à¸™",
    answer: "à¸ªà¸³à¸«à¸£à¸±à¸šà¸­à¸²à¸ˆà¸²à¸£à¸¢à¹Œà¹à¸žà¸—à¸¢à¹Œà¸—à¸µà¹ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸‡à¸²à¸™ à¸“ à¸„à¸“à¸°à¹à¸žà¸—à¸¢à¸¨à¸²à¸ªà¸•à¸£1. à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ 2. à¸ à¸²à¸£à¸°à¸‡à¸²à¸™à¸ªà¸­à¸™ à¸ˆà¸³à¸™à¸§à¸™ 1 à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² à¸—à¸¸à¸à¸£à¸²à¸¢à¸§à¸´à¸Šà¸² à¸—à¸¸à¸à¸«à¸±à¸§à¸‚à¹‰à¸­à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” à¹„à¸¡à¹ˆà¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸² 45 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡(à¹€à¸Šà¹ˆà¸™ à¸«à¸²à¸à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸à¸²à¸£à¸ªà¸­à¸™à¹ƒà¸™à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² 2567 à¹ƒà¸Šà¹‰à¸ à¸²à¸£à¸°à¸‡à¸²à¸™à¸ªà¸­à¸™à¹ƒà¸™à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² 2566) 3. à¹€à¸­à¸à¸ªà¸²à¸£à¸›à¸£à¸°à¸à¸­à¸šà¸à¸²à¸£à¸ªà¸­à¸™ à¸ˆà¸³à¸™à¸§à¸™ 2 à¸«à¸±à¸§à¸‚à¹‰à¸­ à¸«à¸±à¸§à¸‚à¹‰à¸­à¸¥à¸° 4 à¹€à¸¥à¹ˆà¸¡ à¸£à¸§à¸¡à¹€à¸›à¹‡à¸™ 8 à¹€à¸¥à¹ˆà¸¡ (à¹€à¸‚à¸µà¸¢à¸™à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¸•à¸²à¸¡à¸«à¸¥à¸±à¸à¸§à¸´à¸Šà¸²à¸à¸²à¸£à¹„à¸¡à¹ˆà¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸² 20 à¸«à¸™à¹‰à¸² à¹„à¸¡à¹ˆà¸£à¸§à¸¡à¹€à¸­à¸à¸ªà¸²à¸£à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡) 1 à¹ƒà¸™ 2 à¸«à¸±à¸§à¸‚à¹‰à¸­ à¸ˆà¸°à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™à¸«à¸±à¸§à¸‚à¹‰à¸­à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸à¸²à¸£à¸ªà¸­à¸™à¸•à¸²à¸¡à¸•à¸²à¸£à¸²à¸‡à¸ªà¸­à¸™à¸—à¸µà¹ˆà¹à¸™à¸šà¸¡à¸² 4. à¸•à¸²à¸£à¸²à¸‡à¸ªà¸­à¸™ à¸—à¸µà¹ˆà¸ˆà¸°à¹ƒà¸Šà¹‰à¹€à¸›à¹‡à¸™à¸«à¸±à¸§à¸‚à¹‰à¸­à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸à¸²à¸£à¸ªà¸­à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸­à¸²à¸ˆà¸²à¸£à¸¢à¹Œà¸žà¸´à¹€à¸¨à¸© 1. à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸ˆà¸²à¸à¸•à¹‰à¸™à¸ªà¸±à¸‡à¸à¸±à¸” à¸œà¹ˆà¸²à¸™à¸œà¸¹à¹‰à¸šà¸±à¸‡à¸„à¸±à¸šà¸šà¸±à¸à¸Šà¸²à¸•à¸²à¸¡à¸¥à¸³à¸”à¸±à¸š 2. à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¹à¸•à¹ˆà¸‡à¸•à¸±à¹‰à¸‡à¹€à¸›à¹‡à¸™à¸­à¸²à¸ˆà¸²à¸£à¸¢à¹Œà¸žà¸´à¹€à¸¨à¸©à¹„à¸¡à¹ˆà¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸² 1 à¸›à¸µ 3. à¸ à¸²à¸£à¸°à¸‡à¸²à¸™à¸ªà¸­à¸™ à¸ˆà¸³à¸™à¸§à¸™ 1 à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² à¸—à¸¸à¸à¸£à¸²à¸¢à¸§à¸´à¸Šà¸² à¸—à¸¸à¸à¸«à¸±à¸§à¸‚à¹‰à¸­à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” à¹„à¸¡à¹ˆà¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸² 45 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡ (à¹€à¸Šà¹ˆà¸™ à¸«à¸²à¸à¸ˆà¸°à¸‚à¸­à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸à¸²à¸£à¸ªà¸­à¸™à¹ƒà¸™à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² 2567 à¹ƒà¸Šà¹‰à¸ à¸²à¸£à¸°à¸‡à¸²à¸™à¸ªà¸­à¸™à¹ƒà¸™à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² 2566)  4. à¸•à¸²à¸£à¸²à¸‡à¸ªà¸­à¸™à¸—à¸µà¹ˆà¸ˆà¸°à¹ƒà¸Šà¹‰à¹€à¸›à¹‡à¸™à¸«à¸±à¸§à¸‚à¹‰à¸­à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸à¸²à¸£à¸ªà¸­à¸™5. à¹€à¸­à¸à¸ªà¸²à¸£à¸›à¸£à¸°à¸à¸­à¸šà¸à¸²à¸£à¸ªà¸­à¸™ à¸ˆà¸³à¸™à¸§à¸™ 2 à¸«à¸±à¸§à¸‚à¹‰à¸­ à¸«à¸±à¸§à¸‚à¹‰à¸­à¸¥à¸° 4 à¹€à¸¥à¹ˆà¸¡ à¸£à¸§à¸¡à¹€à¸›à¹‡à¸™ 8 à¹€à¸¥à¹ˆà¸¡ (à¹€à¸‚à¸µà¸¢à¸™à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¸•à¸²à¸¡à¸«à¸¥à¸±à¸à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¹„à¸¡à¹ˆà¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸² 20 à¸«à¸™à¹‰à¸² à¹„à¸¡à¹ˆà¸£à¸§à¸¡à¹€à¸­à¸à¸ªà¸²à¸£à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡) 1 à¹ƒà¸™ 2 à¸«à¸±à¸§à¸‚à¹‰à¸­ à¸ˆà¸°à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™à¸«à¸±à¸§à¸‚à¹‰à¸­à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸à¸²à¸£à¸ªà¸­à¸™ à¸•à¸²à¸¡à¸•à¸²à¸£à¸²à¸‡à¸ªà¸­à¸™à¸—à¸µà¹ˆà¹à¸™à¸šà¸¡à¸² 6. à¸ªà¸³à¹€à¸™à¸² à¸à¸ž.7  (à¸žà¸£à¹‰à¸­à¸¡à¸£à¸±à¸šà¸£à¸­à¸‡à¸ªà¸³à¹€à¸™à¸²à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡) 7. à¸ªà¸³à¹€à¸™à¸²à¸§à¸¸à¸’à¸´à¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² (à¸žà¸£à¹‰à¸­à¸¡à¸£à¸±à¸šà¸£à¸­à¸‡à¸ªà¸³à¹€à¸™à¸²à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡) à¹€à¸£à¸´à¹ˆà¸¡à¸•à¸±à¹‰à¸‡à¹à¸•à¹ˆà¸§à¸¸à¸’à¸´à¸›à¸£à¸´à¸à¸à¸²à¸•à¸£à¸µ à¸£à¸§à¸¡à¸–à¸¶à¸‡à¸§à¸¸à¸’à¸´à¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸²à¹€à¸‰à¸žà¸²à¸°à¸—à¸²à¸‡à¸”à¹‰à¸²à¸™à¸•à¹ˆà¸²à¸‡à¹†",
  },
  {
    id: "q4",
    question: "à¸ à¸²à¸£à¸°à¸‡à¸²à¸™à¸ªà¸­à¸™à¸¡à¸µà¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸‡à¸šà¹‰à¸²à¸‡",
    answer: "à¸ à¸²à¸£à¸°à¸‡à¸²à¸™à¸ªà¸­à¸™ à¸ˆà¸³à¸™à¸§à¸™ 1 à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² à¸—à¸¸à¸à¸£à¸²à¸¢à¸§à¸´à¸Šà¸² à¸—à¸¸à¸à¸«à¸±à¸§à¸‚à¹‰à¸­à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” à¹„à¸¡à¹ˆà¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸² 45 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡ (à¹€à¸Šà¹ˆà¸™ à¸«à¸²à¸à¸ˆà¸°à¸‚à¸­à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸à¸²à¸£à¸ªà¸­à¸™à¹ƒà¸™à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² 2567 à¹ƒà¸Šà¹‰à¸ à¸²à¸£à¸°à¸‡à¸²à¸™à¸ªà¸­à¸™à¹ƒà¸™à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² 2566)  à¸—à¸¸à¸à¸„à¸“à¸° à¸—à¸¸à¸à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£à¸—à¸µà¹ˆà¸ªà¸–à¸²à¸šà¸±à¸™à¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸²à¸£à¸±à¸šà¸£à¸­à¸‡à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£ à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸›à¸à¸´à¸šà¸±à¸•à¸´à¹à¸¥à¸°à¸—à¸¤à¸©à¸Žà¸µ",
  },
];

app.post("/webhook", line.middleware(config), async (req, res) => {
  try {
    await Promise.all((req.body.events || []).map(handleEvent));
    res.status(200).end();
  } catch (err) {
    console.error("âŒ /webhook error:", err);
    res.status(500).end();
  }
});

app.post("/callback", line.middleware(config), async (req, res) => {
  try {
    await Promise.all((req.body.events || []).map(handleEvent));
    res.status(200).end();
  } catch (err) {
    console.error("âŒ /callback error:", err);
    res.status(500).end();
  }
});

// Health check à¸à¸±à¸™à¸‡à¸‡
app.get("/", (req, res) => res.status(200).send("OK"));
app.get("/webhook", (req, res) => res.status(200).send("OK /webhook"));
app.get("/callback", (req, res) => res.status(200).send("OK /callback"));

/**
 * =========================
 * 3) MAIN EVENT HANDLER
 * =========================
 */
async function handleEvent(event) {
  // âœ… à¹€à¸žà¸´à¹ˆà¸¡à¹€à¸žà¸·à¹ˆà¸­à¸™à¹à¸¥à¹‰à¸§à¹€à¸”à¹‰à¸‡à¹€à¸¡à¸™à¸¹à¸—à¸±à¸™à¸—à¸µ
  if (event.type === "follow") {
    return client.replyMessage(event.replyToken, [
      { type: "text", text: "à¸ªà¸§à¸±à¸ªà¸”à¸µà¸„à¹ˆà¸° âœ… à¹€à¸¥à¸·à¸­à¸à¸„à¸³à¸–à¸²à¸¡à¸ˆà¸²à¸à¹€à¸¡à¸™à¸¹à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡à¹„à¸”à¹‰à¹€à¸¥à¸¢" },
      makeQuestionMenuFlex(),
    ]);
  }

  // âœ… à¸£à¸±à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
  if (event.type === "message" && event.message.type === "text") {
    const text = (event.message.text || "").trim().toLowerCase();

    // à¸žà¸´à¸¡à¸žà¹Œ qa/quiz => à¹‚à¸Šà¸§à¹Œà¹€à¸¡à¸™à¸¹
    if (text === "qa" || text === "quiz") {
      return client.replyMessage(event.replyToken, [
        { type: "text", text: "à¹€à¸¥à¸·à¸­à¸à¸„à¸³à¸–à¸²à¸¡à¸ˆà¸²à¸à¹€à¸¡à¸™à¸¹à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡à¹„à¸”à¹‰à¹€à¸¥à¸¢ âœ…" },
        makeQuestionMenuFlex(),
      ]);
    }

    // à¸—à¸²à¸‡à¸¥à¸±à¸”: q1 q2 q3
    const m = text.match(/^q(\d+)$/);
    if (m) {
      const id = `q${m[1]}`;
      const item = QA.find((x) => x.id === id);
      if (item) {
        return client.replyMessage(event.replyToken, [
          { type: "text", text: `ðŸ“Œ ${item.question}\n\n${item.answer}` },
          makeSmallMenuButtonsFlex(),
        ]);
      }
    }

    // à¸„à¸³à¸­à¸·à¹ˆà¸™à¹†
    return client.replyMessage(event.replyToken, {
      type: "text",
      text: "à¸žà¸´à¸¡à¸žà¹Œ 'qa' à¹€à¸žà¸·à¹ˆà¸­à¸”à¸¹à¹€à¸¡à¸™à¸¹à¸„à¸³à¸–à¸²à¸¡ à¸«à¸£à¸·à¸­à¸žà¸´à¸¡à¸žà¹Œ q1/q2/q3 à¹€à¸žà¸·à¹ˆà¸­à¸”à¸¹à¸„à¸³à¸•à¸­à¸šà¸—à¸±à¸™à¸—à¸µ âœ…",
    });
  }

  // âœ… à¸£à¸±à¸š postback (à¸à¸”à¸à¸¥à¹ˆà¸­à¸‡à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§/à¸›à¸¸à¹ˆà¸¡)
  if (event.type === "postback") {
    const data = event.postback?.data || "";
    const parts = data.split("|"); // qa|show|q1 à¸«à¸£à¸·à¸­ qa|menu à¸«à¸£à¸·à¸­ qa|restart

    // à¸à¸¥à¸±à¸šà¹€à¸¡à¸™à¸¹
    if (parts[0] === "qa" && parts[1] === "menu") {
      return client.replyMessage(event.replyToken, makeQuestionMenuFlex());
    }

    // à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆ
    if (parts[0] === "qa" && parts[1] === "restart") {
      return client.replyMessage(event.replyToken, [
        { type: "text", text: "à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆà¹à¸¥à¹‰à¸§ âœ… à¹€à¸¥à¸·à¸­à¸à¸„à¸³à¸–à¸²à¸¡à¹„à¸”à¹‰à¹€à¸¥à¸¢" },
        makeQuestionMenuFlex(),
      ]);
    }

    // à¹à¸ªà¸”à¸‡à¸„à¸³à¸•à¸­à¸šà¸ˆà¸²à¸à¸„à¸³à¸–à¸²à¸¡à¸—à¸µà¹ˆà¸à¸”
    if (parts[0] === "qa" && parts[1] === "show") {
      const qid = parts[2];
      const item = QA.find((x) => x.id === qid);

      if (!item) {
        return client.replyMessage(event.replyToken, {
          type: "text",
          text: "à¹„à¸¡à¹ˆà¸žà¸šà¸„à¸³à¸–à¸²à¸¡à¸™à¸µà¹‰à¸„à¸£à¸±à¸š à¸žà¸´à¸¡à¸žà¹Œ 'qa' à¹€à¸žà¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆ âœ…",
        });
      }

      return client.replyMessage(event.replyToken, [
        { type: "text", text: `ðŸ“Œ ${item.question}\n\n${item.answer}` },
        makeSmallMenuButtonsFlex(),
      ]);
    }

    return client.replyMessage(event.replyToken, {
      type: "text",
      text: "à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ à¸žà¸´à¸¡à¸žà¹Œ 'qa' à¹€à¸žà¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆ âœ…",
    });
  }

  return null;
}

/**
 * =========================
 * 4) FLEX: à¹€à¸¡à¸™à¸¹à¸„à¸³à¸–à¸²à¸¡ (à¸à¸¥à¹ˆà¸­à¸‡à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§)
 * =========================
 * âœ… à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸™à¸à¸¥à¹ˆà¸­à¸‡à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§ = item.question
 * âœ… à¸£à¸­à¸‡à¸£à¸±à¸šà¸„à¸³à¸–à¸²à¸¡à¸¢à¸²à¸§ + wrap à¹„à¸”à¹‰
 */
function makeQuestionMenuFlex() {
  return {
    type: "flex",
    altText: "à¹€à¸¡à¸™à¸¹à¸„à¸³à¸–à¸²à¸¡",
    contents: {
      type: "bubble",
      size: "kilo",
      body: {
        type: "box",
        layout: "vertical",
        spacing: "md",
        contents: [
          { type: "text", text: "à¹€à¸¥à¸·à¸­à¸à¸„à¸³à¸–à¸²à¸¡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£", weight: "bold", size: "lg" },
          {
            type: "text",
            text: "à¹à¸•à¸°à¸—à¸µà¹ˆà¸à¸¥à¹ˆà¸­à¸‡à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§à¹€à¸žà¸·à¹ˆà¸­à¸”à¸¹à¸„à¸³à¸•à¸­à¸šà¸—à¸±à¸™à¸—à¸µ âœ…",
            size: "sm",
            color: "#666666",
            wrap: true,
          },
          { type: "separator" },

          ...QA.map((item, idx) => ({
  type: "box",
  layout: "horizontal",
  paddingAll: "14px",
  cornerRadius: "14px",
  backgroundColor: "#00C853",
  spacing: "md",
  action: {
    type: "postback",
    data: `qa|show|${item.id}`,
    displayText: item.question,
  },
  contents: [
    // à¹€à¸¥à¸‚à¸‚à¹‰à¸­à¹à¸šà¸šà¸§à¸‡à¸à¸¥à¸¡ (à¸—à¸³à¹ƒà¸«à¹‰à¸”à¸¹à¹€à¸›à¹‡à¸™à¸£à¸°à¹€à¸šà¸µà¸¢à¸š)
    {
      type: "box",
      layout: "vertical",
      width: "28px",
      height: "28px",
      cornerRadius: "14px",
      backgroundColor: "#00A843",
      justifyContent: "center",
      alignItems: "center",
      contents: [
        {
          type: "text",
          text: String(idx + 1),
          size: "sm",
          weight: "bold",
          color: "#FFFFFF",
        },
      ],
    },

    // à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸„à¸³à¸–à¸²à¸¡ (à¸‚à¸¢à¸²à¸¢à¸ªà¸¹à¸‡à¸•à¸²à¸¡à¸ˆà¸£à¸´à¸‡à¹€à¸žà¸£à¸²à¸° wrap=true)
    {
      type: "text",
      text: item.question,
      wrap: true,
      flex: 1,
      size: "sm",
      weight: "bold",
      color: "#FFFFFF",
    },
  ],
})),
  
        ],
      },
    },
  };
}

/**
 * =========================
 * 5) FLEX: à¸›à¸¸à¹ˆà¸¡à¸«à¸¥à¸±à¸‡à¸•à¸­à¸šà¸„à¸³à¸–à¸²à¸¡
 * =========================
 */
function makeSmallMenuButtonsFlex() {
  return {
    type: "flex",
    altText: "à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸",
    contents: {
      type: "bubble",
      size: "kilo",
      body: {
        type: "box",
        layout: "vertical",
        spacing: "sm",
        contents: [
          {
            type: "button",
            style: "primary",
            action: {
              type: "postback",
              label: "à¸à¸¥à¸±à¸šà¹„à¸›à¹€à¸¡à¸™à¸¹à¸„à¸³à¸–à¸²à¸¡",
              data: "qa|menu",
              displayText: "à¸à¸¥à¸±à¸šà¹„à¸›à¹€à¸¡à¸™à¸¹à¸„à¸³à¸–à¸²à¸¡",
            },
          },
        ],
      },
    },
  };
}
/**
 * =========================
 * 6) START SERVER
 * =========================
 */
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => console.log("âœ… Server running at port", PORT));
